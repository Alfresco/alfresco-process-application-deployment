suite: test runtime-bundle deployment
templates:
  - charts/runtime-bundle/templates/deployment.yaml
tests:
  - it: should be a deployment apps/v1
    values:
      - ./values/chart.yaml
    asserts:
      - isKind:
          of: Deployment
      - isAPIVersion:
          of: apps/v1
      - hasDocuments:
          count: 1
  - it: should have extra init container
    values:
      - ./values/chart.yaml
      - ./values/runtime_bundle_init_container.yaml
    set:
      runtime-bundle:
        applicationVersion: 100
        expectedProjectSizeInBytes: 1000
    asserts:
      - equal:
          path: spec.template.spec.initContainers[1].name
          value: init-runtime
      - equal:
          path: spec.template.spec.initContainers[1].env[0].value
          value: 100
      - equal:
          path: spec.template.spec.initContainers[1].env[1].value
          value: 1000
